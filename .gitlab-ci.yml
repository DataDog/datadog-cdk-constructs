stages:
  - build

serverless-remote-instrumentation ci image:
  stage: build
  image: registry.ddbuild.io/images/docker:20.10
  tags: ["arch:arm64"]
  # rules:
  #   - if: '$CI_COMMIT_BRANCH == "main" && $CI_PIPELINE_SOURCE == "push"'
  #     changes:
  #       - serverless-remote-instrumentation/Dockerfile
  #     when: on_success
  when: manual
  variables:
    DOCKER_TARGET: registry.ddbuild.io/ci/serverless-remote-instrumentation:latest
  script:
    - docker buildx build --platform linux/amd64,linux/arm64 --no-cache --pull --push --tag ${DOCKER_TARGET} -f serverless-remote-instrumentation/Dockerfile serverless-remote-instrumentation/
    